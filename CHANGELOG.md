# 变更日志

本项目遵循 [语义化版本控制](https://semver.org/lang/zh-CN/) 规范。

## [1.0.2] - 2025-01-27

### 🔌 使用改进和兼容性修复
- **WebSocket 连接管理优化**：完整的连接生命周期管理和消息路由
- **传输协议接口统一**：所有传输协议实现统一的事件处理接口
- **服务器事件路由增强**：新增 `setupTransportEventHandlers()` 方法
- **JSON Schema 格式兼容性**：修复空参数工具的格式问题，符合 Cursor 要求

### 🛠️ 核心功能改进
- **WebSocketTransport 增强**：
  - 添加连接状态跟踪 (`currentConnection`)
  - 完善事件处理器 (`onConnect`, `onClose`, `onError`)
  - 改进消息路由机制
- **TransportInterface 扩展**：
  - 新增连接生命周期事件方法
  - 统一所有传输协议的事件处理接口
- **Server 类优化**：
  - 新增 `setupTransportEventHandlers()` 方法
  - 改进传输协议事件到服务器事件的绑定
- **ToolManager 修复**：
  - 修复空参数工具的 JSON Schema 格式问题
  - 确保空对象 `{}` 而不是空数组 `[]`

### 📊 兼容性提升
- **Cursor IDE 集成**：修复 JSON Schema 格式兼容性问题
- **MCP 协议合规**：确保工具列表格式符合协议要求
- **WebSocket 稳定性**：提升连接稳定性和消息传递可靠性
- **事件系统完善**：统一的事件处理机制

### 🔄 向后兼容
- 保持原有 API 接口不变
- 保持原有配置格式兼容
- 保持原有工具定义方式
- 新增功能不影响现有代码

## [1.0.1] - 2025-01-27

### 🚀 重大优化
- **Stdio 传输协议全面优化**：利用 Workerman 的常驻进程和事件驱动优势
- **非阻塞 I/O 处理**：使用 `stream_set_blocking()` 和 `stream_select()` 实现非阻塞输入
- **事件驱动架构**：利用 Workerman Timer 进行定时缓冲区处理
- **智能模式选择**：支持 `auto`、`optimized`、`blocking` 三种模式

### 🔧 核心改进
- **新增 OptimizedStdioTransport**：优化的非阻塞实现，支持缓冲区管理和优雅关闭
- **新增 LegacyStdioTransport**：传统阻塞式实现，保持向后兼容
- **重构 StdioTransport**：智能工厂类，自动选择最优实现
- **配置系统增强**：添加 stdio 专用配置选项和环境变量支持

### 📊 性能提升
- **响应性提升**：非阻塞 I/O 避免主线程阻塞
- **资源利用优化**：更好的 CPU 和内存使用效率
- **稳定性增强**：完善的错误恢复和优雅关闭机制
- **可观测性**：提供传输协议状态信息和性能监控

### 🛠️ 代码质量
- **PHP 8.2+ 兼容性**：修复隐式可空类型弃用警告
- **配置验证优化**：stdio 模式智能跳过网络配置验证
- **传输协议修复**：完善所有传输协议类的属性和方法
- **注释完善**：添加详细的类和方法注释

### 🔌 使用改进
- **WebSocket 连接管理**：完整的连接生命周期管理和消息路由
- **传输协议接口统一**：所有传输协议实现统一的事件处理接口
- **服务器事件路由**：新增 `setupTransportEventHandlers()` 方法
- **JSON Schema 格式兼容性**：修复空参数工具的格式问题，符合 Cursor 要求

### 📚 文档更新
- **新增 stdio-optimization.md**：详细的优化说明和使用指南
- **更新项目状态文档**：记录最新的优化成果
- **代码整理总结**：完整的代码清理和优化记录
- **使用改进总结**：详细的使用问题修复记录

### 🔄 向后兼容
- 保持原有 API 接口不变
- 默认配置向后兼容
- 支持渐进式升级
- 自动模式选择确保最佳兼容性

## [1.0.0] - 2025-01-XX

###  正式发布
- 基于 PHP8.2+ 和 Workerman 4.0+ 的高性能 MCP 服务器
- 支持 MCP (Model Context Protocol) 完整协议
- 零外部 MCP 依赖，完全自主实现

### 🚀 核心功能
- 支持多种传输协议：stdio、HTTP、WebSocket、HTTP+SSE、Streamable HTTP
- 自动 MCP 元素发现和注册
- 完整的工具、资源、提示管理
- 会话管理和状态保持
- 完善的错误处理和日志记录

### ️ 开发工具
- 支持自定义工具开发
- 提供计算器工具示例
- 完整的测试覆盖
- Docker 容器化支持
- 详细的文档和示例

### 🏗️ 技术特性
- 使用 PHP 8 Attributes 定义 MCP 元素
- 遵循 PSR-4 自动加载规范
- 支持 PSR-3 日志接口
- 完整的类型声明和文档注释
- 代码质量工具集成（PHPStan、PHP CS Fixer）
- 自动化测试和代码覆盖率报告

### ️ 架构设计
- 模块化设计，易于扩展
- 事件驱动的架构
- 依赖注入支持
- 配置管理灵活
- 传输协议可插拔

###  兼容性
- 支持 PHP 8.0+ 所有版本
- 与主流静态分析工具兼容
- 与主流 IDE 兼容
- 完善的类型安全性

###  文档
- 完整的 API 文档
- 详细的安装和配置指南
- 丰富的使用示例
- 编辑器集成指南
- 代码质量检查报告

## [未发布]

### 计划中
- 支持更多传输协议
- 增强的安全特性
- 性能优化
- 更多内置工具
- 集群支持
- 监控和指标收集
